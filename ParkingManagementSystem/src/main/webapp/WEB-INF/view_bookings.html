<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Booking Details</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="" />
    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content="" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:card" content="" />
    <link rel="shortcut icon" href="favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700" rel="stylesheet">
    <!-- Animate.css -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <!-- Flexslider  -->
    <link rel="stylesheet" href="css/flexslider.css">
    <!-- Flaticons  -->
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Modernizr JS -->
    <script src="js/modernizr-2.6.2.min.js"></script>
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  </head>
  <style>




#toast {
    visibility: hidden;
    max-width: 50px;
    height: 50px;
    /*margin-left: -125px;*/
    margin: auto;
    background-color: #d9534f;
    color: #fff;
    text-align: center;
    border-radius: 2px;

    position: fixed;
    z-index: 1;
    left: 0;right:0;
    bottom: 30px;
    font-size: 17px;
    white-space: nowrap;
}
#toast #img{
	width: 50px;
	height: 50px;
    
    float: left;
    
    padding-top: 16px;
    padding-bottom: 16px;
    
    box-sizing: border-box;

    
    background-color: #d9534f;
    color: #fff;
}
#toast #desc{

    
    color: #fff;
   
    padding: 16px;
    
    overflow: hidden;
	white-space: nowrap;
}

#toast.show {
    visibility: visible;
    -webkit-animation: fadein 0.5s, expand 0.5s 0.5s,stay 3s 1s, shrink 0.5s 2s, fadeout 0.5s 2.5s;
    animation: fadein 0.5s, expand 0.5s 0.5s,stay 3s 1s, shrink 0.5s 4s, fadeout 0.5s 4.5s;
}

#toast2 {
    visibility: hidden;
    max-width: 50px;
    height: 50px;
    /*margin-left: -125px;*/
    margin: auto;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 2px;

    position: fixed;
    z-index: 1;
    left: 0;right:0;
    bottom: 30px;
    font-size: 17px;
    white-space: nowrap;
}
#toast2 #img2{
	width: 50px;
	height: 50px;
    
    float: left;
    
    padding-top: 16px;
    padding-bottom: 16px;
    
    box-sizing: border-box;

    
    background-color: #111;
    color: #fff;
}
#toast2 #desc{

    
    color: #fff;
   
    padding: 16px;
    
    overflow: hidden;
	white-space: nowrap;
}

#toast2.show2 {
    visibility: visible;
    -webkit-animation: fadein 0.5s, expand 0.5s 0.5s,stay 3s 1s, shrink 0.5s 2s, fadeout 0.5s 2.5s;
    animation: fadein 0.5s, expand 0.5s 0.5s,stay 3s 1s, shrink 0.5s 4s, fadeout 0.5s 4.5s;
}
@-webkit-keyframes fadein {
    from {bottom: 0; opacity: 0;} 
    to {bottom: 30px; opacity: 1;}
}

@keyframes fadein {
    from {bottom: 0; opacity: 0;}
    to {bottom: 30px; opacity: 1;}
}

@-webkit-keyframes expand {
    from {min-width: 50px} 
    to {min-width: 350px}
}

@keyframes expand {
    from {min-width: 50px}
    to {min-width: 350px}
}
@-webkit-keyframes stay {
    from {min-width: 350px} 
    to {min-width: 350px}
}

@keyframes stay {
    from {min-width: 350px}
    to {min-width: 350px}
}
@-webkit-keyframes shrink {
    from {min-width: 350px;} 
    to {min-width: 50px;}
}

@keyframes shrink {
    from {min-width: 350px;} 
    to {min-width: 50px;}
}

@-webkit-keyframes fadeout {
    from {bottom: 30px; opacity: 1;} 
    to {bottom: 60px; opacity: 0;}
}

@keyframes fadeout {
    from {bottom: 30px; opacity: 1;}
    to {bottom: 60px; opacity: 0;}
}

   
    

    .row {
      margin-left: -42px;
      margin-right: -15px;
    }
  </style>
  <body>
    <div id="colorlib-page">
      <a class="js-colorlib-nav-toggle colorlib-nav-toggle">
        <i></i>
      </a>
      <aside id="colorlib-aside" role="complementary" class="border js-fullheight">
        <h1 id="colorlib-logo"></h1>
        <nav id="colorlib-main-menu" role="navigation">
          <ul>
            <li>
              <a href="index.html">Dashboard</a>
            </li>
            <li>
              <a href="user_details.html">Manage Users</a>
            </li>
            <li class="colorlib-active">
              <a href="view_bookings.html">Manage Bookings</a>
            </li>
          </ul>
        </nav>
      </aside>
      <div id="colorlib-main">
        <div class="colorlib-contact">
          <div class="colorlib-narrow-content">
            <div class="row">
              <div class="col-md-12 animate-box" data-animate-effect="fadeInLeft">
                <h2 class="colorlib-heading">Booking Details</h2>
              </div>
            </div>
            <div class="row">
              
              <br>
              <div class="col-lg-12">
                <table class="table table-dark table-hover" id="customers">
                  
                  <input type="text" id="myInput" placeholder="Search for names.." title="Type in a name">
                  
                  

                  <thead>
                    <tr>
                      <!-- <th>No </th> -->
                      <th>Car Number</th>
                      <th>Slot Id </th>
                      <th>Name </th>
                      <th>date </th>
                      <th>Start Time </th>
                      <th>Duration </th>
                      <th>End Time</th>
                      <th>Cost</th>
                      <th>Checkout</th>
                      <th>Book Again</th>

                    </tr>
                  </thead>
                  <tbody id="book"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="toast"><div id="img"><i class="fa-solid fa-trash"></i></div><div id="desc">Deleted Successfully!</div></div>
    <div id="toast2"><div id="img2"><i class="fa-solid fa-brake-warning"></i></div><div id="desc">Not Deleted!</div></div>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- jQuery -->
    <script src="js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Waypoints -->
    <script src="js/jquery.waypoints.min.js"></script>
    <!-- Flexslider -->
    <script src="js/jquery.flexslider-min.js"></script>
    <!-- Sticky Kit -->
    <script src="js/sticky-kit.min.js"></script>
    <!-- Owl carousel -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- Counters -->
    <script src="js/jquery.countTo.js"></script>
    <!-- MAIN JS -->
    <script src="js/main.js"></script>
    <script>
      function bookform(){
        location.replace("Book_parking.html")
      }
     
    </script>
    <script>
      var ajax = new XMLHttpRequest();
      var method = "GET";
      var url = "http://localhost:8080/ParkingSlot2/view";
      var asynchronous = true;
      ajax.open(method, url, asynchronous);
      ajax.send();
      ajax.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var data = JSON.parse(this.responseText);
          console.log(data)
          var html = "";
          for (var a = 0; a < data.length; a++) {
            var id = data[a].id;
            var car_number = data[a].car_number;
            var slot_id = data[a].slot_id;
            var user_name = data[a].user_name;
            var date = data[a].date;
            var start_time = data[a].start_time;
            var parking_hrs = data[a].parking_hrs;
            var endtime = data[a].endtime;
            var parking_cost = data[a].parking_cost;
            html += " <tr> ";
            // html += " <td> " + id + " </td>";
            html += " <td> " + car_number + " </td>";
            html += " <td> " + slot_id + " </td>";
            html += " <td> " + user_name + " </td>";
            html += " <td> " + date + " </td>";
            html += " <td> " + start_time + " </td>";
            html += " <td> " + parking_hrs + " </td>";
            html += " <td> " + endtime + " </td>";
            html += " <td> " + parking_cost + " </td>";
            html += " <td> " + ` <button onclick = 'deleteid(${id});update(${slot_id})'
            class = "btn btn-danger btn-md" ><i class="fa-solid fa-trash-can"></i>  </button>`+ " </td>"
            html += " <td> " + ` <button onclick = 'bookagain(${id})';
            class = "btn btn-warning btn-md" ><i class="fa-solid fa-arrow-rotate-right"></i> </button>`+ " </td>"
            html += " </tr>";
          }
          document.getElementById("book").innerHTML = html;
        }
      }
      $(document).ready(function() {
                $("#myInput").on("keyup", function() {
                    var value = $(this).val().toLowerCase();
                    $("#book tr").filter(function() {
                        $(this).toggle($(this).text()
                        .toLowerCase().indexOf(value) > -1)
                    });
                });
            });
      function deleteid(id) {
        var result = confirm('Are you sure you want to delete?');
        if (result == false) {
          var x = document.getElementById("toast2")
    x.className = "show2";
    setTimeout(function(){ x.className = x.className.replace("show2", ""); }, 3000);
        } else {
            fetch(`http://localhost:8080/ParkingSlot2/remove/${id}`, {
            method: 'DELETE'
          }).then(() => {
            console.log('removed');
            var x = document.getElementById("toast")
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
            window.setTimeout(function() {
            window.location.href = 'view_bookings.html';
           }, 3000);

          }).catch(err => {
            console.error(err)
          });
        }
      }

      function update(slot_id) {
        console.log(slot_id)
        var ajax = new XMLHttpRequest();
        var method = "GET";
        var url = "http://localhost:8080/ParkingSlot2/slotinfo";
        var asynchronous = true;
        ajax.open(method, url, asynchronous);
        ajax.send();
        ajax.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            var data = JSON.parse(this.responseText);
            console.log(data)
            console.log(data[(slot_id) - 1])
            let data1 = {
              id: data[(slot_id) - 1].id,
              slot_id: data[(slot_id) - 1].slot_id,
              slot_name: data[(slot_id) - 1].slot_name,
              booked: false
            }
            console.log(data1)
            params = {
              method: 'PUT',
              headers: {
                'Access-Control_Allow_Origin': "*",
                'Content-Type': 'application/json',
                'mode': 'no-cors',
                'Accept': 'application/json'
              },
              body: JSON.stringify(data1)
            }
            fetch('http://localhost:8080/ParkingSlot2/update', params).then((response) => {
              response.json()
            }).then(data => console.log(data));
          }
        }
      }
      
      
  
      async function bookagain(id){
        var requestOptions = {
          method:'GET',
          redirect:'follow'
        };
        await fetch(`http://localhost:8080/ParkingSlot2/get/${id}`,requestOptions)
        .then(response => response.json())
        .then((result)=>{ 
         var cn = result.car_number
         var un = result.user_name
         console.log(cn)
         localStorage.setItem('CN',cn);
         localStorage.setItem('UN',un);
         location.replace("bp1.html");
         
        })
       
     
      }

     
    </script>
  </body>
</html>